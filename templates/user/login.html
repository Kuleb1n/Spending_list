{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'user/css/login.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
{% endblock %}

{% block title %}
    Sign-up
{% endblock %}

{% block body %}
    <div class="main">
        <input type="checkbox" id="chk" aria-hidden="true">
        {% if form.errors or messages %}
        {% if messages %}
        {% for message in messages %}
        <div class="message">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endif %}
        <div class="login">
            <form method="post" action="{% url 'login' %}">
                {% csrf_token %}
                <div class="form-error">
                    {{ form.non_field_errors }}
                </div>
                <label for="chk" aria-hidden="true">
                    Login
                </label>
                <input type="email" name="username" autofocus=""
                       maxlength="254" id="id_username1" placeholder="Email" required="">
                <input type="password" name="password" autocomplete="current-password" id="id_password"
                       placeholder="Password" required="">
                <button type="submit">
                    Enter
                </button>
            </form>
        </div>
        <div class="register">
            <form method="post" action="{% url 'register' %}">
                {% csrf_token %}
                <label for="chk" aria-hidden="true">
                    Registration
                </label>
                <input type="email" name="email" placeholder="Email" maxlength="254" required="" id="id_email">
                <div class="form-error">
                    {{ form.email.errors }}
                </div>
                <input type="text" name="username" placeholder="Username" required="" maxlength="150" id="id_username">
                <div class="exists"></div>
                <div class="form-error">
                    {{ form.username.errors }}
                </div>
                <input type="password" name="password1" placeholder="Password" maxlength="128" required=""
                       id="id_password1">
                <div class="form-error">
                    {{ form.password1.errors }}
                </div>
                <input type="password" name="password2" placeholder="Repeat password" maxlength="128" required=""
                       id="id_password2">
                <div class="form-error">
                    {{ form.password2.errors }}
                </div>
                <button type="submit">
                    Sign up
                </button>
            </form>
        </div>
    </div>
<script>
    $( document ).ready(function() {
        $('#id_username').keyup(function () {
    // creating an AJAX call
    $.ajax({
        data: $(this).serialize(),
        url: "{% url 'validate_username' %}",
        success: function (response) {
            if (response.is_taken == true) {
                $('#id_username').removeClass('is-valid').addClass('is-invalid');
                $('.exists').append('Such a username already exists!').css({'color': 'red', 'text-align': 'center'});
            }
            if (response.is_taken == false) {
                $('#id_username').removeClass('is-invalid').addClass('is-valid');
                $('.exists').empty();
            }
        },
        error: function (response) {
            console.log(response.responseJSON.errors)
        }
    });
    return false;
});
    });
</script>
{% endblock %}